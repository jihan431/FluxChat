<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FluxChat</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.5.4/socket.io.min.js"></script>
</head>
<body>
  <div class="chat-container">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="sidebar-header">
        <div class="user-profile">
          <div class="avatar" id="currentUserAvatar">
            U
            <span class="status-badge online"></span>
          </div>
          <div class="user-info">
            <h3 id="currentUserName">User</h3>
          </div>
        </div>
        <button class="btn-icon" onclick="logout()" title="Logout">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4M16 17l5-5-5-5M21 12H9"/>
          </svg>
        </button>
      </div>

      <div class="search-box">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="11" cy="11" r="8"/>
          <path d="m21 21-4.35-4.35"/>
        </svg>
        <input type="text" placeholder="Cari kontak..." id="searchUsers">
      </div>

      <div class="users-list" id="usersList">
        <!-- Users will be rendered here -->
      </div>
    </aside>

    <!-- Main Chat Area -->
    <main class="chat-main">
      <div id="chatPlaceholder" class="chat-placeholder">
        <div class="placeholder-content">
          <svg width="120" height="120" viewBox="0 0 120 120" fill="none">
            <circle cx="60" cy="60" r="55" fill="#f0f2f5"/>
            <path d="M40 50C40 44.4772 44.4772 40 50 40H70C75.5228 40 80 44.4772 80 50V60C80 65.5228 75.5228 70 70 70H64L56 80L48 70H50C44.4772 70 40 65.5228 40 60V50Z" fill="#0088cc"/>
          </svg>
          <h2>Pilih Chat untuk Memulai</h2>
          <p>Pilih kontak dari sidebar untuk memulai percakapan</p>
        </div>
      </div>

      <div id="chatArea" class="chat-area hidden">
        <div class="chat-header">
          <button class="btn-icon btn-toggle-sidebar" onclick="goBackToSidebar()" title="Kembali">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M15 19l-7-7 7-7"/>
            </svg>
          </button>
          <div class="chat-user-info" onclick="showUserInfo()">
            <div class="avatar" id="selectedUserAvatar">
              U
              <span class="status-badge" id="selectedUserStatus"></span>
            </div>
            <div>
              <h3 id="selectedUserName">User</h3>
              <span class="typing-indicator hidden" id="typingIndicator">
                sedang mengetik
                <span class="dots">
                  <span class="dot"></span>
                  <span class="dot"></span>
                  <span class="dot"></span>
                </span>
              </span>
            </div>
          </div>
          <div class="chat-actions">
            <button class="btn-icon" onclick="startCall('voice')" title="Voice Call">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/>
              </svg>
            </button>
            <button class="btn-icon" onclick="startCall('video')" title="Video Call">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polygon points="23 7 16 12 23 17 23 7"/>
                <rect x="1" y="5" width="15" height="14" rx="2" ry="2"/>
              </svg>
            </button>
            <button class="btn-icon" title="More">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="1" fill="currentColor"/>
                <circle cx="12" cy="5" r="1" fill="currentColor"/>
                <circle cx="12" cy="19" r="1" fill="currentColor"/>
              </svg>
            </button>
          </div>
        </div>

        <div class="chat-messages" id="chatMessages">
          <!-- Messages will be rendered here -->
        </div>

        <!-- File Preview (hidden by default) -->
        <div id="filePreview" class="file-preview hidden">
          <div class="file-preview-icon">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"/>
              <polyline points="13 2 13 9 20 9"/>
            </svg>
          </div>
          <div class="file-preview-info">
            <div class="file-preview-name" id="filePreviewName">document.pdf</div>
            <div class="file-preview-size" id="filePreviewSize">2.5 MB</div>
          </div>
          <button class="file-preview-close" onclick="cancelFileUpload()">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="18" y1="6" x2="6" y2="18"/>
              <line x1="6" y1="6" x2="18" y2="18"/>
            </svg>
          </button>
        </div>

        <!-- Emoji Picker (hidden by default) -->
        <div id="emojiPicker" class="emoji-picker hidden">
          <div class="emoji-picker-header">
            <input type="text" class="emoji-search" placeholder="Cari emoji..." id="emojiSearch">
          </div>
          <div class="emoji-categories">
            <button class="emoji-category active" data-category="smileys">üòä</button>
            <button class="emoji-category" data-category="animals">üê∂</button>
            <button class="emoji-category" data-category="food">üçï</button>
            <button class="emoji-category" data-category="activities">‚öΩ</button>
            <button class="emoji-category" data-category="travel">‚úàÔ∏è</button>
            <button class="emoji-category" data-category="objects">üí°</button>
            <button class="emoji-category" data-category="symbols">‚ù§Ô∏è</button>
          </div>
          <div class="emoji-grid" id="emojiGrid">
            <!-- Emojis will be rendered here -->
          </div>
        </div>

        <div class="chat-input-area">
          <button class="btn-icon" onclick="toggleEmojiPicker()" title="Emoji">
            <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"/>
              <path d="M8 14s1.5 2 4 2 4-2 4-2"/>
              <line x1="9" y1="9" x2="9.01" y2="9"/>
              <line x1="15" y1="9" x2="15.01" y2="9"/>
            </svg>
          </button>
          <input type="file" id="fileInput" style="display: none;" onchange="handleFileSelect(event)">
          <button class="btn-icon" onclick="document.getElementById('fileInput').click()" title="Attach File">
            <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"/>
            </svg>
          </button>
          <div class="chat-input-wrapper">
            <input type="text" id="messageInput" placeholder="Ketik pesan..." disabled>
          </div>
          <button class="btn-send" onclick="sendMessage()" disabled>
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="22" y1="2" x2="11" y2="13"/>
              <polygon points="22 2 15 22 11 13 2 9 22 2"/>
            </svg>
          </button>
        </div>
      </div>
    </main>
  </div>

  <!-- Incoming Call Modal -->
  <div id="incomingCallModal" class="modal hidden">
    <div class="modal-overlay" onclick="rejectCall()"></div>
    <div class="modal-content call-modal">
      <div class="call-avatar">
        <div class="avatar large" id="callerAvatar">U</div>
        <div class="pulse-ring"></div>
      </div>
      <h3 id="callerName">User</h3>
      <p id="callType" class="call-type">Video Call masuk...</p>
      <div class="call-actions">
        <button class="btn-call reject" onclick="rejectCall()">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 9c-1.6 0-3.15.25-4.6.72v3.1c0 .39-.23.74-.56.9-.98.49-1.87 1.12-2.66 1.85-.18.18-.43.28-.7.28-.28 0-.53-.11-.71-.29L.29 13.08c-.18-.17-.29-.42-.29-.7 0-.28.11-.53.29-.71C3.34 8.78 7.46 7 12 7s8.66 1.78 11.71 4.67c.18.18.29.43.29.71 0 .28-.11.53-.29.71l-2.48 2.48c-.18.18-.43.29-.71.29-.27 0-.52-.11-.7-.28-.79-.74-1.68-1.36-2.66-1.85-.33-.16-.56-.5-.56-.9v-3.1C15.15 9.25 13.6 9 12 9z"/>
          </svg>
          Tolak
        </button>
        <button class="btn-call accept" onclick="acceptCall()">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
            <path d="M20.01 15.38c-1.23 0-2.42-.2-3.53-.56-.35-.12-.74-.03-1.01.24l-1.57 1.97c-2.83-1.35-5.48-3.9-6.89-6.83l1.95-1.66c.27-.28.35-.67.24-1.02-.37-1.11-.56-2.3-.56-3.53 0-.54-.45-.99-.99-.99H4.19C3.65 3 3 3.24 3 3.99 3 13.28 10.73 21 20.01 21c.71 0 .99-.63.99-1.18v-3.45c0-.54-.45-.99-.99-.99z"/>
          </svg>
          Terima
        </button>
      </div>
    </div>
  </div>

  <!-- Active Call -->
  <div id="activeCall" class="modal hidden">
    <div class="modal-overlay"></div>
    <div class="video-call-container">
      <div id="videoGrid" class="video-grid">
        <video id="remoteVideo" autoplay playsinline></video>
        <video id="localVideo" autoplay muted playsinline class="local-video"></video>
      </div>
      <div class="call-controls">
        <button class="control-btn" onclick="toggleMute()" id="muteBtn" title="Mute">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"/>
            <path d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"/>
          </svg>
        </button>
        <button class="control-btn" onclick="toggleVideo()" id="videoBtn" title="Camera">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
            <path d="M17 10.5V7c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1v-3.5l4 4v-11l-4 4z"/>
          </svg>
        </button>
        <button class="control-btn end-call" onclick="endCall()" title="End Call">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 9c-1.6 0-3.15.25-4.6.72v3.1c0 .39-.23.74-.56.9-.98.49-1.87 1.12-2.66 1.85-.18.18-.43.28-.7.28-.28 0-.53-.11-.71-.29L.29 13.08c-.18-.17-.29-.42-.29-.7 0-.28.11-.53.29-.71C3.34 8.78 7.46 7 12 7s8.66 1.78 11.71 4.67c.18.18.29.43.29.71 0 .28-.11.53-.29.71l-2.48 2.48c-.18.18-.43.29-.71.29-.27 0-.52-.11-.7-.28-.79-.74-1.68-1.36-2.66-1.85-.33-.16-.56-.5-.56-.9v-3.1C15.15 9.25 13.6 9 12 9z"/>
          </svg>
        </button>
      </div>
      <div class="call-info">
        <span id="callDuration">00:00</span>
      </div>
    </div>
  </div>

  <script src="app.js"></script>
</body>
</html>
